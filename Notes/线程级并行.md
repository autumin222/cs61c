## 多处理器执行模式

* 每个处理器（核）执行自己的指令流

* 资源分离
  
  * 数据路径（PC，寄存器，ALU）
  
  * 多级缓存（L1，L2）

* 资源共享
  
  * 内存（DRAM）
  
  * 第三级缓存（L3）

## 多核

* 由于内存在不同的核之间是共享的，所以在使用内存时，需要相互通信，协调内存的使用

## 线程

即一条单一的指令流，占有PC，寄存器

* 物理线程：正在硬件上执行的线程

* 逻辑线程：所有需要执行或正在执行的任务

### 多线程

对于一个CPU，执行多个任务（线程）的方式是**分时**

需要控制线程的删除，开始，切换（保存寄存器，PC到内存中）

* 通过硬件：
  
  超线程——使得一个物理CPU具有多个逻辑CPU，通过添加PC和一些寄存器，使得一个CPU可以同时运行多个线程，提高了资源的利用率

### 高速内存一致性

多核情况下，处理器中对同一地址缓存的值可以不一致

#### 有效位控制

* 当发生读时，不影响有效位

* 当发生写时，将其他的缓存设置为无效（或者设置为同样的最新的值）

某个处理器对某一地址的值进行修改时，应通知其他的处理器，将其他的缓存对该地址的valid位设置为0（无效），使得其他的处理器不会对该地址进行缓存命中，从而避免了缓存的不一致。

当缓存未命中时，有两种处理方式

1. 在其他缓存中查找

2. 从内存中获取

**多核Cache一致性由硬件保证，对软件来说是透明的。现在CPU硬件采用的一致性协议一般是MESI的变种，例如ARM64架构采用的MOESI Protocol**
