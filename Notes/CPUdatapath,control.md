## CPU

+ datapath：用于表现出所需操作的硬件
  
  对指令的反应

+ Control：决定datapath的不同部分的工作

### CPU时钟

对于单个CPU周期，一个指令完成所有阶段

* 时钟周期需要足够长以允许每个指令都能在一个周期内完成所有为五个阶段

### 设计处理器

1. 分析指令集，明确数据通路的需求

2. 选择数据通路的组成元件，建立时钟方法

3. 装配数据通路以满足需求

4. 分析每个指令的实现，决定影响寄存器传输的控制点

5. 组装控制逻辑（制定逻辑方程，设计电路）

## Datapath

数据通路是由**操作元件**和**存储元件**通过总线方式或分散方式连接而成的进行数据存储、处理、传送的路径。

### 功能

对应risc-V的指令格式，包含R，I，S，SB，U，UJ

即算数，立即数，储存，分支，大写立即数，函数调用

#### R-Type

需要执行一个指令，我们需要

1. 获取这个指令Instruction Fetch
   
   * PC储存了当前指令的地址，+4切换到下一条指令

2. 解析指令字段Decode/Register Read，即阅读指令明确信息（如参数，操作，目的）
   
   * 通过阅读指令的**不同位段**获得信息（rd，rs1，rs2等）

3. 基于解析后的结果获取数据（获取具体的信息）
   
   * 将信息储存到寄存器堆中

4. 执行操作Execute
   
   通过算数逻辑单元ALU执行操作，需要Control分析指令的操作类型（func3和func7字段），将合适的信息通过ALUSel(ect)传给ALU，使其做出要求的计算操作

5. 将结果写入到目的地Reg Write
   
   * 将ALU的运算结果返回给寄存器堆

##### 寄存器堆

* 读：
  
  两个五位的输入线（RA，RB），确定读取的两个寄存器，并将结果从两个32位的输出线输出（portA，portB）

* 写
  
  write Enable输入的值为1
  
  通过RW（5位）获取写入的目的寄存器，将portW（32位）的信息写入

* 读写都受到CLK信号控制

#### I-Type

实现`addi`指令

##### 解析imm字段

* 将12位imm转换为32位

* 12位的imm字段本来在高位（20->31），需要先将其放置到低位，然后在高位进行符号拓展（按符号位）
